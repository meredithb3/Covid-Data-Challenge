---
title: "COVID-19 DataFest"
author: "Meredith Brown, Matt Feder, Pouya Mohammadi"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages

```{r load-packages, message=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(usmap)
```

# Load Datasets

MATT PUT IN DATA INFO HERE (when corona cases stopped tracking, what is pov dataset)

```{r load-data}
covidData <- read.csv("coronacounties.csv")
povertyData <- read.csv("PovertyEstimates.csv")
populationData <- usmap::countypop
populationData$fips <- as.integer(populationData$fips)
```

# Exploratory Data Analysis

First, let's start by glimpsing the 2 datasets.

```{r cov-data}
glimpse(covidData)

covidData %>%
  group_by(fips) %>%
  count()
```

At first glimpse, the COVID-19 dataset has 61,971 observations and 6 variables. However, after grouping by FIPS code, we see that the dataset contains data on 2,709 counties, with repeated observations representing cases on different dates.

```{r pov-data}
glimpse(povertyData)
```

The Poverty dataset has 3,193 observations (counties, states, and the US) and 34 variables.

Both the COVID-19 dataset and the Poverty dataset have a variation of the variable `fips`, which is the Federal Information Processing Standard [https://en.wikipedia.org/wiki/FIPS_county_code] that allows counties to be uniquely identified. 

Thus, the FIPS variable is a good variable by which to join these 2 datasets:

```{r join}
data <- merge(covidData, povertyData, by.x = 'fips', by.y = 'FIPStxt')
glimpse(data)
```

```{r cases-plot, warning=FALSE}
state_cases <- data %>%
  filter(date == "2020-04-15") %>%
  group_by(state) %>%
  summarise(total_cases = sum(cases))

cases_map <- plot_usmap(data = state_cases, values = "total_cases", labels = TRUE, label_color = "gray", color = "red")

cases_map <- cases_map + 
              scale_fill_gradient(low = "white", high = "#CB454A", name = "Cases") +
              labs(title = "Cases by State on April 15, 2020") + 
              labs(subtitle = "Most cases are concentrated in New York State.") + 
              theme(legend.position = "right")

cases_map
```

Need to add histograms for the response variable we choose, the predictors we choose, and plots for the response v. predictors relationships

```{r cases-plot-county, warning=FALSE}
county_cases <- data %>%
  filter(date == "2020-04-15")

county_cases <- merge(x = df1, y = df2, by = "CustomerId", all = TRUE)

county_cases <- county_cases 

county_cases_map <- plot_usmap("counties", data = county_cases, values = "cases", color = "red")

county_cases_map <- county_cases_map + 
              scale_fill_gradient(low = "white", high = "#CB454A", name = "Cases") +
              labs(title = "Cases by County on April 15, 2020") + 
              labs(subtitle = "Most cases are concentrated in New York State.") + 
              theme(legend.position = "right")

county_cases_map
```



# Regression

Ideas for regression
- Linear regression: predict from multiple factors (FIP code, poverty rate, race breakdown, etc.) their number of cases or deaths
- Logistic regression: predict if factors contribute to a death or not (don't think we have specific data on specific cases so this could be challenging)

Assumptions for regression
- Independence
- Linearity
- Normality
- Constant Variance

This website has specific graphs that would be helpful to replicate, but don't know where to get the data on an aggregate level: [https://www.apmresearchlab.org/covid/deaths-by-race#black]
