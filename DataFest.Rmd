---
title: "COVID-19 DataFest"
author: "Meredith Brown, Matt Feder, Pouya Mohammadi"
date: "`r Sys.Date()`"
output: html_document
---

# Load Packages
```{r load-packages, message=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(usmap)
library(ggthemes)
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Datasets and Descriptions
MATT PUT IN DATA INFO HERE (when corona cases stopped tracking, what is pov dataset)

```{r load-data, cache = TRUE}
covidData <- read.csv("coronacounties.csv")
povertyData <- read.csv("PovertyEstimates.csv")
populationData <- usmap::countypop
populationData$fips <- as.integer(populationData$fips)
```


# Section 1: Introduction

### Exploratory Data Analysis
First, let's start by glimpsing the 2 datasets.

```{r cov-data}
glimpse(covidData)

covidData %>%
  group_by(fips) %>%
  count()
```

At first glimpse, the COVID-19 dataset has 61,971 observations and 6 variables. However, after grouping by FIPS code, we see that the dataset contains data on 2,709 counties, with repeated observations representing cases on different dates.

```{r pov-data}
glimpse(povertyData)
```

The Poverty dataset has 3,193 observations (counties, states, and the US) and 34 variables.

Both the COVID-19 dataset and the Poverty dataset have a variation of the variable `fips`, which is the Federal Information Processing Standard [https://en.wikipedia.org/wiki/FIPS_county_code] that allows counties to be uniquely identified. 

Thus, the FIPS variable is a good variable by which to join these 2 datasets:

```{r join}
data <- merge(covidData, povertyData, by.x = 'fips', by.y = 'FIPStxt')
glimpse(data)
```

```{r cases-plot, warning=FALSE}
state_cases <- data %>%
  filter(date == "2020-04-15") %>%
  group_by(state) %>%
  summarise(total_cases = sum(cases))

cases_map <- plot_usmap(data = state_cases, values = "total_cases", labels = TRUE, label_color = "gray", color = "red")

cases_map <- cases_map + 
              scale_fill_gradient(low = "white", high = "#CB454A", name = "Cases") +
              labs(title = "Cases by State on April 15, 2020") + 
              labs(subtitle = "Most cases are concentrated in New York State.") + 
              theme(legend.position = "right")

cases_map
```

Need to add histograms for the response variable we choose, the predictors we choose, and plots for the response v. predictors relationships
(We can do this in the section following - response variable description and predictor descriptions)

```{r cases-plot-county, warning=FALSE}
county_cases <- data %>%
  filter(date == "2020-04-15")

county_cases <- merge(x = populationData, y = county_cases, by = "fips", all = TRUE)

county_cases$log_cases <- log(county_cases$cases)
county_cases$cases[is.na(county_cases$cases)] <- 0
county_cases$log_cases[is.na(county_cases$log_cases)] <- 0

county_cases_map <- plot_usmap("counties", data = county_cases, values = "cases", color = "red", size=0.01)

county_cases_map <- county_cases_map + 
              scale_fill_gradient(low = "white", high = "#CB454A", name = " Cases") +
              labs(title = "Cases by County on April 15, 2020") + 
              labs(subtitle = "Most cases are concentrated in New York State.") + 
              theme(legend.position = "right")

county_cases_map


county_cases_map <- plot_usmap("counties", data = county_cases, values = "log_cases", color = "red", size=0.01)

county_cases_map <- county_cases_map + 
              scale_fill_gradient(low = "white", high = "#CB454A", name = "Log Cases") +
              labs(title = "Log Cases by County on April 15, 2020") + 
              labs(subtitle = "Most cases are concentrated in New York State.") + 
              theme(legend.position = "right")

county_cases_map
```

```{r poverty-plot-county, warning=FALSE}
plot_poverty_data <- data <- merge(populationData, povertyData, by.x = 'fips', by.y = 'FIPStxt')

county_cases_map <- plot_usmap("counties", data = plot_poverty_data, values = "PCTPOVALL_2018", color = "red", size=0.01)

county_cases_map <- county_cases_map + 
              scale_fill_gradient(low = "white", high = "#CB454A", name = "PCTPOVALL_2018") +
              labs(title = "Poverty Level by County (2018 values)") + 
              theme(legend.position = "right")

county_cases_map
```

We should look at histograms of both cases and log(cases) to see if the apparent more even spread of log(cases) is normal compared to regular cases

```{r cases-hist}
county_cases %>%
  ggplot(mapping = aes(x = cases)) +
  geom_histogram(binwidth = 600) + 
  labs(title = "Histogram of Number of Cases per County", x = "Number of Cases",
       y = "# Counties with X Cases")
```

As we predicted, we see an incredible amount of right skewness in the distribution of cases per county.

```{r logcases-hist}
county_cases %>%
  ggplot(mapping = aes(x = log(cases))) +
  geom_histogram(binwidth = 0.5) + 
  labs(title = "Histogram of Number of log of # Cases per County", x = "Number of Cases",
       y = "# Counties with log(X) Cases")
```

This historam of the log(cases) per county shows much more evidence of normailty than the graph of just cases. It would be a much better response variable, however we should analyze some other options as well.

### Description of the Response Variable

### Descriptions of the Regressors


# Section 2: Regression Analysis 
### Generating Our Model

### Testing Our Assumptions

### Multicollinearity

### Interaction Effects

### Influential Points

### Interpreting The Coefficients


# Section 3: Conclusion

### General Commentary

### Discussion of Results

### Limitations and Ideas for Further Research 



# Exploratory Data Analysis



# Regression

Ideas for regression
- Linear regression: predict from multiple factors (FIP code, poverty rate, race breakdown, etc.) their number of cases or deaths
- Logistic regression: predict if factors contribute to a death or not (don't think we have specific data on specific cases so this could be challenging)

Assumptions for regression
- Independence
- Linearity
- Normality
- Constant Variance

This website has specific graphs that would be helpful to replicate, but don't know where to get the data on an aggregate level: [https://www.apmresearchlab.org/covid/deaths-by-race#black]
